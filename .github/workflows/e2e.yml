name: Playwright E2E Tests

on: [push]

jobs:
  e2e:
    runs-on: ubuntu-latest
    steps:
      # Checkout Playwright repo (this one)
      - name: Checkout Playwright tests
        uses: actions/checkout@v3

      # Checkout Angular app from separate repo
      - name: Checkout Angular app
        uses: actions/checkout@v3
        with:
          repository: Abhijit5815/demoAppAngular
          path: angular-app
          token: ${{ secrets.GITHUB_TOKEN }}

      # Install and start Angular app
      - name: Start Angular app
        run: |
          cd angular-app
          npm ci
          npm start &
          sleep 10  # Optional: give it time to boot

      # Wait for localhost:4200 to be ready
      - name: Wait for Angular app
        run: |
          timeout 60 bash -c 'until curl -s http://localhost:4200 > /dev/null; do sleep 2; done'

      # Run Playwright tests
      - name: Run Playwright tests
        run: |
          npm ci
          npx playwright test
