name: Playwright E2E Tests

on: [push]

jobs:
  e2e:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Playwright tests
        uses: actions/checkout@v3

      - name: Checkout Angular app
        uses: actions/checkout@v3
        with:
          repository: Abhijit5815/demoAppAngular
          path: angular-app
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Install Angular dependencies (clean install)
        working-directory: angular-app
        run: npm ci --legacy-peer-deps

      - name: Start Angular app and wait for it to be ready
        run: |
          npm install -g wait-on
          cd angular-app
          nohup npm start > angular.log 2>&1 &
          npx wait-on --timeout 180000 http://localhost:4200

      - name: Verify Angular app is running
        run: |
          curl -I http://localhost:4200 || (tail -20 angular.log && exit 1)

      - name: Install Playwright dependencies
        run: npm ci

      - name: Install Playwright browsers
        run: npx playwright install

      - name: Run Playwright tests
        run: npx playwright test

